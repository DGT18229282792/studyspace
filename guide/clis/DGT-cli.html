<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DGT WORKSPACE</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="used to record the knowledge of front-end development">
    
    <link rel="preload" href="/studyspace/assets/css/0.styles.8762443b.css" as="style"><link rel="preload" href="/studyspace/assets/js/app.cdd353b7.js" as="script"><link rel="preload" href="/studyspace/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/studyspace/assets/js/10.358301fb.js" as="script"><link rel="prefetch" href="/studyspace/assets/js/11.508b6960.js"><link rel="prefetch" href="/studyspace/assets/js/12.e2f6ceed.js"><link rel="prefetch" href="/studyspace/assets/js/13.3e7399b5.js"><link rel="prefetch" href="/studyspace/assets/js/14.6ccaa1fb.js"><link rel="prefetch" href="/studyspace/assets/js/15.b73a667a.js"><link rel="prefetch" href="/studyspace/assets/js/16.03c3ccc5.js"><link rel="prefetch" href="/studyspace/assets/js/17.cbc34ff5.js"><link rel="prefetch" href="/studyspace/assets/js/18.5cc5093e.js"><link rel="prefetch" href="/studyspace/assets/js/19.359c4f3c.js"><link rel="prefetch" href="/studyspace/assets/js/20.1f126015.js"><link rel="prefetch" href="/studyspace/assets/js/3.c8f7d740.js"><link rel="prefetch" href="/studyspace/assets/js/4.0dd8aefa.js"><link rel="prefetch" href="/studyspace/assets/js/5.14db227c.js"><link rel="prefetch" href="/studyspace/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/studyspace/assets/js/7.0076cfb3.js"><link rel="prefetch" href="/studyspace/assets/js/8.2b055684.js"><link rel="prefetch" href="/studyspace/assets/js/9.7c261056.js">
    <link rel="stylesheet" href="/studyspace/assets/css/0.styles.8762443b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/studyspace/" class="home-link router-link-active"><!----> <span class="site-name">DGT WORKSPACE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/studyspace/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/studyspace/guide/info/resume/" class="nav-link">
  个人简历v1
</a></div><div class="nav-item"><a href="/studyspace/guide/info/resumeNew/" class="nav-link">
  个人简历v2
</a></div><div class="nav-item"><a href="/studyspace/guide/utils/utils/" class="nav-link">
  Utils工具类
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/studyspace/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/studyspace/guide/info/resume/" class="nav-link">
  个人简历v1
</a></div><div class="nav-item"><a href="/studyspace/guide/info/resumeNew/" class="nav-link">
  个人简历v2
</a></div><div class="nav-item"><a href="/studyspace/guide/utils/utils/" class="nav-link">
  Utils工具类
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>plugins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>脚手架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/studyspace/guide/clis/DGT-cli.html" aria-current="page" class="active sidebar-link">一个简易的脚手架</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>npm插件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端性能优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>发布一个脚手架，封装常用的项目架构。</p> <p>今天开始搭建自己的脚手架了，这里开始记录一下踩坑的过程。这个系列将会分成极大部分进行更新，第一版本主要是基于脚手架基本的创建流程的介绍，一步一步创建属于自己的定制化的脚手架。下载所指向的仓库模板可以自己去定义。在第一个版本中没有实现高度定制化的功能。只能下载你在github私服里面写好的项目模板。第二个版本现在正在建设中，目标是实现高度定制化的脚手架，通过脚手架自定义生成你所选择的功能模块，比如typescript、babel、vuex、vue2、vue3、vite、axios、pinia等多项定制化功能自动进行项目框架的生成。第三个版本是在第二个版本中作进一步的丰富，将会加入我自己写好的指令库、UI组件库等功能。</p> <p>先放项目npm地址: <a href="https://www.npmjs.com/package/dgt-cli" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/dgt-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这是github脚手架的源码：<a href="https://github.com/DGT18229282792/dgt-cli" target="_blank" rel="noopener noreferrer">https://github.com/DGT18229282792/dgt-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这里先标明所用到的第三方库，chalk：终端文字颜色样式。path：路径模块。</p> <p>fs-extra：文件模块。inquirer：用户交互模块。ora：输出动画模块。</p> <p>项目最终的目录结构：</p> <div class="language-plain extra-class"><pre class="language-plain"><code></code></pre></div><p>dgt-cli
├─ bin   ---存放入口文件
│  └─ enter.js
├─ interactives ---不同用户交互封装，可以自行进行扩展
│  ├─ isOverWrite.js ---处理是否重写同名文件夹
│  └─ selectVueType.js ---选择vue版本
├─ lib ---存放存放指令功能
│  └─ create.js ---command对应的 dgt-cli create 项目名
├─ package-lock.json
├─ package.json ---依赖
├─ README.md ---简介
└─ utils ---存放工具类
   ├─ download.js --- 下载git仓库到目录
   └─ oraClass.js ---动画类</p> <div class="language- extra-class"><pre class="language-text"><code></code></pre></div><p>第一步：</p> <p>初始化项目基本结构，生成基本package.json文件：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>npm init <span class="token operator">-</span>y
</code></pre></div><p>生成：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dgt-cli&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我的第一个脚手架&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DGT&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
<span class="token comment">// 这里配置入口文件，并挂载命令到全局</span>
  <span class="token string">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dgtCli&quot;</span><span class="token operator">:</span><span class="token string">&quot;bin/enter.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在项目根目录下创建bin目录，在bin目录下面创建enter.js:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token hashbang comment">#! /usr/bin/env node</span>
<span class="token comment">// 表明当前环境是在node环境下运行</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'helloWorld'</span><span class="token punctuation">)</span>
</code></pre></div><p>第一行是为了指定当前的环境是node环境，必须要添加，不添加会报错。完成这一步后修改package.json指定入口文件，注意一定要用对象的形式，不然会报错。
第二步：</p> <p>因为与用户进行交互需要用到comannd库，这里先安装一下：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>npm i commander
</code></pre></div><p>现在修改入口文件：Step2: version 方法可以配置版本信息提示
Step3: name 和 usage 方法分别配置 cli 名称和 --help 第一行提示</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token hashbang comment">#! /usr/bin/env node</span>
<span class="token comment">// 表明当前环境是在node环境下运行</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// commander 来实现脚手架命令的配置</span>

program<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;dgt-cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;command&gt; [option]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1.0.0</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// process.argv 是 nodejs 提供的属性</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;helloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当运行dgt-cli create ***的时候会从enter.js开始，</p> <div class="language-plain extra-class"><pre class="language-plain"><code>#! /usr/bin/env node
// 表明当前环境是在node环境下运行
const program = require(&quot;commander&quot;); // commander 来实现脚手架命令的配置
const chalk = require(&quot;chalk&quot;); // chalk用美化终端命令的样式

program.name(&quot;dgt-cli&quot;).usage(`&lt;command&gt; [option]`);
program.version(`dgt-cli ${require(&quot;../package.json&quot;).version}`);
program
  .command(&quot;create &lt;project-name&gt;&quot;) // 增加创建指令
  .description(&quot;use dgt-cli create ** to create a new program&quot;) // 添加描述信息
  .option(
    &quot;-f, --force&quot;,
    &quot;overwrite target directory if it exists(如果目录存在，强制删除)&quot;
  ) // 强制覆盖
  .action((projectName, cmd) =&gt; {
    // 处理用户输入create 指令附加的参数
    require(&quot;../lib/create&quot;)(projectName, cmd);
  });
program
  .command(&quot;config [value]&quot;) // config 命令
  .description(&quot;inspect and modify the config&quot;)
  .option(&quot;-g, --get &lt;key&gt;&quot;, &quot;get value by key&quot;)
  .option(&quot;-s, --set &lt;key&gt; &lt;value&gt;&quot;, &quot;set option[key] is value&quot;)
  .option(&quot;-d, --delete &lt;key&gt;&quot;, &quot;delete option by key&quot;)
  .action((value, keys) =&gt; {
    // value 可以取到 [value] 值，keys会获取到命令参数
    console.log(value, keys);
  });
// 监听 --help 指令
program.on(&quot;--help&quot;, function () {
  // 前后两个空行调整格式，更舒适
  console.log();
  console.log(
    ` Run ${chalk.green(
      &quot;dgt-cli &lt;command&gt; --help&quot;
    )} for detailed usage of given command.`
  );
  console.log();
});

program.parse(process.argv); // process.argv 是 nodejs 提供的属性
</code></pre></div><p>可知这里注册了一个comannd指令，create。
现在进入到create方法里面看一看到底发生了什么？</p> <div class="language-plain extra-class"><pre class="language-plain"><code>/*
*@Description: 创建项目的方法
*@MethodAuthor:  DGT
*@ param: {
    programeName：项目名称,
    cmd:用户口令对象
}
*@ Date: @Date:2022-05-31 20:06:35
*/
const path = require(&quot;path&quot;); // 路径模块
const fs = require(&quot;fs-extra&quot;); // 文件读取操作
const chalk = require(&quot;chalk&quot;); // 输出美化
const download = require(&quot;../utils/download&quot;); //下载仓库代码
const oraClass = require(&quot;../utils/oraClass&quot;); // 封装ora动画

const isOverwriteFun = require(&quot;../interactives/isOverWrite&quot;); // 获取是否覆盖同名文件交互
const selectVueTypeFun = require(&quot;../interactives/selectVueType&quot;); // 获取选择下载的对应的vue2还是vue3的模板仓库

const loadObj = new oraClass();
module.exports = async function (projectName, options) {
  // 获取当前工作目录
  const cwd = process.cwd();
  // 拼接得到项目目录
  const targetDirectory = path.join(cwd, projectName);
  // 判断目录是否存在
  if (fs.existsSync(targetDirectory)) {
    // 判断是否使用 --force 参数
    if (options.force) {
      // 删除重名目录(remove是个异步方法)
      await fs.remove(targetDirectory);
    } else {
      let isOverwrite = await isOverwriteFun();
      // 选择 Cancel
      if (!isOverwrite) {
        console.log(&quot;Cancel&quot;);
        return;
      } else {
        // 选择 Overwirte ，先删除掉原有重名目录
        loadObj.start(&quot;removing origin file...&quot;);
        await fs.remove(targetDirectory);
        loadObj.sucess(&quot;removing origin file success!&quot;);
      }
    }
  }
  let vue_version = await selectVueTypeFun(); // 获取对应的仓库模板
  download(`${returnRightUrl(vue_version)}`, projectName,tips);
};
/*
 *@Description: 根据用户输入返回对应的项目模板地址
 *@MethodAuthor:  DGT
 *@ param: {type:vue版本}
 *@ Date: @Date:2022-06-01 15:24:46
 */
const returnRightUrl = (type) =&gt; {
  const urlMap = new Map();
  urlMap
    .set(&quot;v2&quot;, &quot;github:DGT18229282792/npm-auto-loader&quot;)
    .set(&quot;v3&quot;, &quot;github:DGT18229282792/monitor-sdk&quot;);
  return urlMap.get(type);
}
/*
*@Description: 下载成功提示开启项目
*@MethodAuthor:  DGT
*@ param: {}
*@ Date: @Date:2022-06-02 23:22:27
*/
const tips = (projectName) =&gt;{
  console.log(``)
  console.log(`${chalk.green(`cd ${projectName}`)}`)
  console.log(`${chalk.green(`npm install`)}`)
  console.log(`${chalk.green(`npm run serve`)}`)
  console.log(``)
}
</code></pre></div><p>首先获取当前的工作目录，然后拼接得到项目的目录。然后判断有没有同名的文件夹存在。如果有的话就调用是否覆盖删除同名文件夹方法。然后弹出vue模板选择交互。获取到用户所选择的你事先写好的vue版本。最后调用我们的下载方法进行下载git仓库的项目到我们对应的文件夹中。到这里create指令就结束了。
我们就能够指定git仓库，然后让用户自己选择然后进行下载模板。</p> <p>最后一步是发布到npm。</p> <p>终端登录你的npm账号。执行npm login按照提示进行输入。登录成功后。进行版本的配置。输入npm version 1.0.0指定你的脚手架的第一个版本号。然后执行npm publish进行发布。最后你再登录npm官网，在你的主页就可以看到你刚刚上传的这个脚手架了。</p> <p>其他人使用起来也特别简单。只需要安装npm i dgt-cli就可以了。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">4/24/2023, 7:03:01 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/studyspace/guide/utils/sdk.html" class="prev">
        前端监控埋点实践
      </a></span> <span class="next"><a href="/studyspace/guide/clis/npm.html">
        npm插件开发教程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/studyspace/assets/js/app.cdd353b7.js" defer></script><script src="/studyspace/assets/js/2.733019b2.js" defer></script><script src="/studyspace/assets/js/10.358301fb.js" defer></script>
  </body>
</html>
